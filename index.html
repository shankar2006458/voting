<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PollPulse - Create Polls in Seconds</title>
    <link rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<style>  
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: white;
}
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
}

/* Header */
.header {
    padding: 1.5rem 0;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.vote-icon {
    color: white;
}

.logo h1 {
    font-size: 1.5rem;
    font-weight: 700;
}

/* Buttons */
.btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    font-weight: 500;
    text-decoration: none;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.875rem;
}

.btn-primary {
    background: white;
    color: #667eea;
}

.btn-primary:hover {
    background: rgba(255, 255, 255, 0.9);
}

.btn-outline {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
}

.btn-outline:hover {
    background: rgba(255, 255, 255, 0.2);
}

.btn-ghost {
    background: transparent;
    color: white;
}

.btn-ghost:hover {
    background: rgba(255, 255, 255, 0.1);
}

/* Hero Section */
.hero {
    padding: 3rem 0;
    text-align: center;
}

.hero-title {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
}

.hero-description {
    font-size: 1.25rem;
    opacity: 0.9;
    max-width: 32rem;
    margin: 0 auto 3rem;
}

/* Action Cards */
.action-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    max-width: 32rem;
    margin: 0 auto 3rem;
}

.action-card {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.75rem;
    padding: 1.5rem;
    cursor: pointer;
    transition: all 0.3s;
}

.action-card:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.action-card svg {
    color: white;
    margin-bottom: 1rem;
}

.action-card h3 {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.action-card p {
    opacity: 0.8;
    margin-bottom: 1rem;
}

.join-poll-form {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.join-input {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.375rem;
    padding: 0.75rem;
    color: white;
    font-size: 0.875rem;
}

.join-input::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

/* Features */
.features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    max-width: 48rem;
    margin: 0 auto;
}

.feature {
    text-align: center;
}

.feature svg {
    color: #fbbf24;
    margin-bottom: 1rem;
}

.feature:nth-child(2) svg {
    color: #34d399;
}

.feature:nth-child(3) svg {
    color: #f472b6;
}

.feature h3 {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.feature p {
    opacity: 0.8;
}

/* Polls Section */
.polls-section {
    padding: 3rem 0;
}

.section-title {
    font-size: 2rem;
    font-weight: 700;
    text-align: center;
    margin-bottom: 1.5rem;
}

.polls-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1rem;
}

.poll-card {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.75rem;
    padding: 1.5rem;
    cursor: pointer;
    transition: all 0.3s;
}

.poll-card:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.poll-card-title {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: white;
}

.poll-card-description {
    opacity: 0.7;
    margin-bottom: 1rem;
    font-size: 0.875rem;
}

.poll-card-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.875rem;
    opacity: 0.8;
    margin-bottom: 0.75rem;
}

.poll-card-meta span {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.poll-card-options {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
}

.option-badge {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

.modal.show {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: 0.75rem;
    max-width: 32rem;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    color: #374151;
    animation: fadeInUp 0.5s cubic-bezier(.23,1.01,.32,1) both;
    box-shadow: 0 8px 32px rgba(102,126,234,0.15), 0 1.5px 8px rgba(56,249,215,0.08);
    border: 1.5px solid #38f9d7;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(40px) scale(0.98);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 1.5rem 1.5rem 0;
}

.modal-header h2 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
}

.modal-header p {
    color: #6b7280;
}

.close-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.25rem;
    color: #6b7280;
}

.modal-body {
    padding: 1.5rem;
}

/* Form */
.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    font-weight: 500;
    margin-bottom: 0.5rem;
    color: #374151;
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    background: white;
}

.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.option-input {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    align-items: center;
}

.option-input input {
    flex: 1;
}

.remove-option-btn {
    background: #ef4444;
    color: white;
    border: none;
    padding: 0.5rem;
    border-radius: 0.375rem;
    cursor: pointer;
    transition: background 0.2s, transform 0.2s;
}

.remove-option-btn:hover {
    background: #ef4444cc;
    transform: scale(1.1) rotate(-10deg);
}

.add-option-btn {
    font-size: 1rem;
    font-weight: 600;
    margin-top: 0.5rem;
    background: #34d399;
    color: white;
    border: none;
    transition: background 0.2s, transform 0.2s;
}

.add-option-btn:hover {
    background: #43e97b;
    color: #fff;
    transform: scale(1.05);
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
}

.checkmark {
    width: 1rem;
    height: 1rem;
    border: 1px solid #d1d5db;
    border-radius: 0.25rem;
    position: relative;
}

input[type="checkbox"]:checked + .checkmark {
    background: #667eea;
    border-color: #667eea;
}

input[type="checkbox"]:checked + .checkmark::after {
    content: "âœ“";
    position: absolute;
    color: white;
    font-size: 0.75rem;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

input[type="checkbox"] {
    display: none;
}

.form-actions {
    display: flex;
    gap: 0.75rem;
    padding-top: 1rem;
}

.form-actions .btn {
    flex: 1;
}

/* Poll Page */
.poll-page {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.poll-header {
    padding: 1.5rem 0;
}

.poll-header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.poll-actions {
    display: flex;
    gap: 0.5rem;
}

.poll-main {
    padding-bottom: 3rem;
}

.poll-info {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.75rem;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.poll-title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.poll-description {
    opacity: 0.8;
    margin-bottom: 1rem;
}

.poll-meta {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
    font-size: 0.875rem;
    opacity: 0.8;
}

.poll-meta span {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.poll-badge {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
}

.poll-options {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2rem;
}

.poll-option {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.75rem;
    padding: 1.5rem;
    cursor: pointer;
    transition: all 0.3s;
}

.poll-option:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
}

.poll-option.selected {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.4);
    transform: scale(1.02);
}

.poll-option.disabled {
    cursor: not-allowed;
    background: rgba(255, 255, 255, 0.05);
}

.option-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
}

.option-text {
    font-weight: 500;
    font-size: 1.125rem;
}

.option-stats {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
}

.progress-bar {
    height: 0.75rem;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 0.375rem;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: white;
    transition: width 0.5s ease;
}

.vote-section {
    text-align: center;
    margin-bottom: 2rem;
}

.vote-btn {
    background: white;
    color: #667eea;
    padding: 0.75rem 2rem;
    font-size: 1.125rem;
    font-weight: 600;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: all 0.2s;
}

.vote-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.vote-btn:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.9);
}

.vote-hint {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    opacity: 0.8;
}

.results-summary {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.75rem;
    padding: 1.5rem;
}

.results-summary h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

.results-summary p {
    opacity: 0.8;
    margin-bottom: 0.5rem;
}

/* Toast */
.toast-container {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 2000;
}

.toast {
    background: white;
    color: #374151;
    padding: 1rem;
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 0.5rem;
    min-width: 300px;
    animation: slideIn 0.3s ease;
}

.toast.success {
    border-left: 4px solid #10b981;
}

.toast.error {
    border-left: 4px solid #ef4444;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Responsive */
@media (max-width: 768px) {
    .hero-title {
        font-size: 2rem;
    }
    
    .action-cards {
        grid-template-columns: 1fr;
    }
    
    .features {
        grid-template-columns: 1fr;
    }
    
    .polls-grid {
        grid-template-columns: 1fr;
    }
    
    .poll-header-content {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }
    
    .poll-actions {
        justify-content: center;
    }
    
    .form-actions {
        flex-direction: column;
    }
}

/* Extra mobile responsiveness */
@media (max-width: 480px) {
    .container {
        padding: 0 0.5rem;
    }
    .hero-title {
        font-size: 1.3rem;
    }
    .modal-content {
        max-width: 98vw;
        padding: 0.5rem;
    }
    .modal-header, .modal-body {
        padding: 1rem 0.5rem 0.5rem 0.5rem;
    }
    .form-group input,
    .form-group textarea {
        font-size: 1rem;
        padding: 0.5rem;
    }
    .btn, .vote-btn {
        font-size: 1rem;
        padding: 0.5rem 0.75rem;
    }
    .poll-title {
        font-size: 1.2rem;
    }
    .poll-info, .results-summary {
        padding: 1rem;
    }
    .poll-option {
        padding: 1rem;
    }
    .empty-state {
        padding: 2rem 0.5rem;
    }
    footer {
        font-size: 0.85rem;
        padding: 1rem 0 0.5rem 0;
    }
}

/* Make poll options scrollable on very small screens */
@media (max-width: 350px) {
    .poll-options {
        gap: 0.5rem;
    }
    .option-text {
        font-size: 0.95rem;
    }
}
</style>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <svg class="vote-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 12l2 2 4-4"/>
                        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
                        <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
                        <path d="M3 12v6a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3v-6"/>
                    </svg>
                    <h1>PollPulse</h1>
                </div>
                <button class="btn btn-outline" onclick="showCreatePoll()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Create Poll
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h2 class="hero-title">Create Polls in Seconds</h2>
                <p class="hero-description">
                    The fastest way to create polls, gather opinions, and make data-driven decisions. 
                    Get instant results and beautiful analytics.
                </p>
                
                <!-- Action Cards -->
                <div class="action-cards">
                    <div class="action-card" onclick="showCreatePoll()">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        <h3>Create a Poll</h3>
                        <p>Start a new poll in seconds</p>
                    </div>
                    
                    <div class="action-card">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"/>
                            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
                            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
                            <path d="M3 12v6a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3v-6"/>
                        </svg>
                        <h3>Join a Poll</h3>
                        <div class="join-poll-form">
                            <input type="text" id="joinCode" placeholder="Enter poll code" class="join-input">
                            <button class="btn btn-primary" onclick="joinPoll()">Join Poll</button>
                        </div>
                    </div>
                </div>

                <!-- Features -->
                <div class="features">
                    <div class="feature">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"></polygon>
                        </svg>
                        <h3>Lightning Fast</h3>
                        <p>Create and share polls instantly</p>
                    </div>
                    <div class="feature">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
                        </svg>
                        <h3>Real-time Results</h3>
                        <p>Watch votes come in live</p>
                    </div>
                    <div class="feature">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                            <path d="M16 6l-4-4-4 4"></path>
                            <line x1="12" y1="2" x2="12" y2="15"></line>
                        </svg>
                        <h3>Easy Sharing</h3>
                        <p>Share with a simple code</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recent Polls -->
        <section class="polls-section">
            <div class="container">
                <h3 class="section-title">Your Polls</h3>
                <div id="pollsList" class="polls-grid"></div>
            </div>
        </section>
    </main>

    <!-- Poll Creator Modal -->
    <div id="pollCreatorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Poll</h2>
                <button class="close-btn" onclick="hideCreatePoll()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="pollForm">
                    <div class="form-group">
                        <label for="pollQuestion">Poll Question *</label>
                        <input type="text" id="pollQuestion" placeholder="What's your question?" required>
                    </div>

                    <div class="form-group">
                        <label for="pollDescription">Description (optional)</label>
                        <textarea id="pollDescription" placeholder="Add more context to your poll..." rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Answer Options</label>
                        <div id="optionsContainer">
                            <div class="option-input">
                                <input type="text" placeholder="Option 1" required>
                            </div>
                            <div class="option-input">
                                <input type="text" placeholder="Option 2" required>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline add-option-btn" onclick="addOption()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Option
                        </button>
                    </div>

                    <div class="form-group" style="position:relative;">
                        <label for="pollPassword">Poll Password <span style="color:#ef4444">*</span></label>
                        <input type="password" id="pollPassword" placeholder="Set a password to manage this poll" required autocomplete="new-password">
                        <button type="button" id="togglePassword" style="position:absolute; right:10px; top:38px; background:none; border:none; cursor:pointer; color:#374151;">
                            Show
                        </button>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="hideCreatePoll()">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                                <path d="M16 6l-4-4-4 4"></path>
                                <line x1="12" y1="2" x2="12" y2="15"></line>
                            </svg>
                            Create Poll
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Poll Page (hidden by default) -->
    <div id="pollPage" class="poll-page" style="display: none;">
        <header class="poll-header">
            <div class="container">
                <div class="poll-header-content">
                    <button class="btn btn-ghost" onclick="goHome()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15,18 9,12 15,6"></polyline>
                        </svg>
                        Back to Home
                    </button>
                    <div class="poll-actions">
                        <button class="btn btn-outline" onclick="copyPollCode()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Code: <span id="currentPollCode"></span>
                        </button>
                        <button class="btn btn-outline" onclick="sharePoll()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                                <path d="M16 6l-4-4-4 4"></path>
                                <line x1="12" y1="2" x2="12" y2="15"></line>
                            </svg>
                            Share
                        </button>
                        <button class="btn btn-outline" onclick="promptDeletePoll()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3,6 5,6 21,6"></polyline>
                                <path d="m19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                            </svg>
                            Delete Poll
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main class="poll-main">
            <div class="container">
                <div id="pollContent"></div>
            </div>
        </main>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Vote Success Modal -->
    <div id="voteSuccessModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:3000; align-items:center; justify-content:center;">
      <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color:#222; border-radius:1rem; padding:2.5rem 2rem; text-align:center; box-shadow:0 8px 32px rgba(0,0,0,0.2); animation: popIn 0.5s;">
        <svg width="64" height="64" fill="none" stroke="#fff" stroke-width="2" style="margin-bottom:1rem;">
          <circle cx="32" cy="32" r="30" stroke="#fff" fill="#10b981"/>
          <polyline points="20,34 30,44 46,24" stroke="#fff" stroke-width="4" fill="none"/>
        </svg>
        <h2 style="margin-bottom:0.5rem;">You voted successfully!</h2>
        <p style="margin-bottom:1.5rem;">Thank you for participating ðŸŽ‰</p>
        <button onclick="closeVoteSuccessModal()" style="background:#fff; color:#10b981; border:none; border-radius:0.5rem; padding:0.75rem 2rem; font-size:1rem; font-weight:600; cursor:pointer;">OK</button>
      </div>
    </div>
    <style>
    @keyframes popIn {
      0% { transform: scale(0.7); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    </style>

    <!-- Footer -->
    <footer style="width:100%;text-align:center;padding:1.5rem 0 1rem 0;opacity:0.7;font-size:0.95rem;position:relative;z-index:10;">
        Â© 2025 Shankar Prasad Pyke. All rights reserved.
    </footer>

    <!-- Firebase App (core) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<!-- Firestore -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
  // Your Firebase config from step 2
const firebaseConfig = {
  apiKey: "AIzaSyD6p7_0v07Y5hc-q2PFqLY4S62NunMkt54",
  authDomain: "voting-a3041.firebaseapp.com",
  projectId: "voting-a3041",
  storageBucket: "voting-a3041.firebasestorage.app",
  messagingSenderId: "719655386135",
  appId: "1:719655386135:web:6c82195e5215f709cd3052",
  measurementId: "G-LD825X2M9N"
};
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>
</body>
<script>
    
// Poll Storage and Management
class PollManager {
    constructor() {
        this.polls = this.loadPolls();
        this.currentPoll = null;
        this.userId = this.getUserId();
    }

    // Generate unique IDs
    generateId() {
        return Math.random().toString(36).substring(2, 8).toUpperCase();
    }

    generateOptionId() {
        return Math.random().toString(36).substring(2, 15);
    }

    // User ID management
    getUserId() {
        let userId = localStorage.getItem('pollUserId');
        if (!userId) {
            userId = Math.random().toString(36).substring(2, 15);
            localStorage.setItem('pollUserId', userId);
        }
        return userId;
    }

    // Storage management
    loadPolls() {
        const stored = localStorage.getItem('polls');
        return stored ? JSON.parse(stored) : {};
    }

    savePolls() {
        localStorage.setItem('polls', JSON.stringify(this.polls));
    }

    // Poll operations
    createPoll(pollData) {
        const pollId = this.generateId();
        const poll = {
            id: pollId,
            question: pollData.question,
            description: pollData.description || '',
            options: pollData.options.map(text => ({
                id: this.generateOptionId(),
                text: text,
                votes: 0
            })),
            isMultipleChoice: pollData.isMultipleChoice || false,
            createdAt: new Date().toISOString(),
            votedUsers: [],
            password: pollData.password, // store hashed password
            userId: this.userId // <-- Add this line
        };

        this.polls[pollId] = poll;
        this.savePolls();
        // Save poll to Firestore
        console.log('Saving poll to Firestore:', poll);
        db.collection('polls').doc(pollId).set(poll);
        return pollId;
    }

    getPoll(pollId) {
        return this.polls[pollId];
    }

    vote(pollId, optionIds, userId) {
        const poll = this.polls[pollId];
        if (!poll || poll.votedUsers.includes(userId)) {
            return false;
        }

        poll.votedUsers.push(userId);
        poll.options.forEach(option => {
            if (optionIds.includes(option.id)) {
                option.votes++;
            }
        });

        this.savePolls();

        // Save updated votes to Firestore
        db.collection('polls').doc(pollId).update({
            options: poll.options,
            votedUsers: poll.votedUsers
        });

        return true;
    }

    hasUserVoted(pollId, userId) {
        const poll = this.polls[pollId];
        return poll ? poll.votedUsers.includes(userId) : false;
    }

    getRecentPolls(limit = 6) {
        return Object.values(this.polls)
            .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
            .slice(0, limit);
    }

    deletePoll(pollId) {
        delete this.polls[pollId];
        this.savePolls();
    }
}

// Toast notifications
function showToast(message, type = 'success') {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    
    container.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

// Initialize poll manager
const pollManager = new PollManager();

// Modal management
function showCreatePoll() {
    document.getElementById('pollCreatorModal').classList.add('show');
}

function hideCreatePoll() {
    document.getElementById('pollCreatorModal').classList.remove('show');
    document.getElementById('pollForm').reset();
    resetOptions();
    document.getElementById('pollPassword').type = 'password'; // Reset to password type
    document.getElementById('togglePassword').textContent = 'Show';
}

// Option management
function addOption() {
    const container = document.getElementById('optionsContainer');
    const optionCount = container.children.length;
    
    if (optionCount >= 20) return; // <-- Increase this number as needed
    
    const optionDiv = document.createElement('div');
    optionDiv.className = 'option-input';
    optionDiv.innerHTML = `
        <input type="text" placeholder="Option ${optionCount + 1}" required>
        ${optionCount >= 2 ? `
        <button type="button" class="remove-option-btn" onclick="removeOption(this)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="m19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
            </svg>
        </button>
        ` : ''}
    `;
    
    container.appendChild(optionDiv);
}

function removeOption(button) {
    const container = document.getElementById('optionsContainer');
    if (container.children.length > 2) {
        button.parentElement.remove();
        updateOptionPlaceholders();
    }
}

function resetOptions() {
    const container = document.getElementById('optionsContainer');
    container.innerHTML = `
        <div class="option-input">
            <input type="text" placeholder="Option 1" required>
        </div>
        <div class="option-input">
            <input type="text" placeholder="Option 2" required>
        </div>
    `;
}

function updateOptionPlaceholders() {
    const inputs = document.querySelectorAll('#optionsContainer input');
    inputs.forEach((input, index) => {
        input.placeholder = `Option ${index + 1}`;
    });
}

// Form submission
document.getElementById('pollForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const question = document.getElementById('pollQuestion').value.trim();
    const description = document.getElementById('pollDescription').value.trim();
    const isMultipleChoice = false; // <-- Always single choice now
    const password = document.getElementById('pollPassword').value.trim();

    const optionInputs = document.querySelectorAll('#optionsContainer input');
    const options = Array.from(optionInputs)
        .map(input => input.value.trim())
        .filter(text => text.length > 0);

    if (!question) {
        showToast('Please enter a question', 'error');
        return;
    }

    if (options.length < 2) {
        showToast('Please provide at least 2 options', 'error');
        return;
    }

    if (!password) {
        showToast('Please set a password for this poll', 'error');
        return;
    }

    const pollId = pollManager.createPoll({
        question,
        description,
        options,
        isMultipleChoice,
        password: hashPassword(password)
    });

    showToast('Poll created successfully!');
    hideCreatePoll();
    showPoll(pollId);
});

// Poll display
function renderPolls() {
    const container = document.getElementById('pollsList');
    // Only show polls created by the current user
    const polls = pollManager.getRecentPolls().filter(poll => poll.userId === pollManager.userId);

    if (polls.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
                </svg>
                <p>No polls yet. Be the first to create one!</p>
            </div>
        `;
        return;
    }

    container.innerHTML = polls.map(poll => {
        const totalVotes = poll.options.reduce((sum, option) => sum + option.votes, 0);
        const date = new Date(poll.createdAt).toLocaleDateString();

        return `
            <div class="poll-card" onclick="showPoll('${poll.id}')">
                <h3 class="poll-card-title">${poll.question}</h3>
                ${poll.description ? `<p class="poll-card-description">${poll.description}</p>` : ''}
                <div class="poll-card-meta">
                    <span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        ${totalVotes} votes
                    </span>
                    <span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12,6 12,12 16,14"></polyline>
                        </svg>
                        ${date}
                    </span>
                </div>
                <div class="poll-card-options">
                    ${poll.options.slice(0, 2).map(option => 
                        `<span class="option-badge">${option.text.length > 15 ? option.text.substring(0, 15) + '...' : option.text}</span>`
                    ).join('')}
                    ${poll.options.length > 2 ? `<span class="option-badge">+${poll.options.length - 2} more</span>` : ''}
                </div>
            </div>
        `;
    }).join('');
}

// Poll page management
let pollUnsubscribe = null; // Add this at the top level to manage listeners

function showPoll(pollId) {
    // Remove previous listener if any
    if (pollUnsubscribe) {
        pollUnsubscribe();
        pollUnsubscribe = null;
    }
    let poll = pollManager.getPoll(pollId);
    if (!poll) {
        // Listen for real-time updates from Firestore
        pollUnsubscribe = db.collection('polls').doc(pollId).onSnapshot(doc => {
            if (doc.exists) {
                const data = doc.data();
                const options = (data.options || []).map(option => ({
                    id: option.id || pollManager.generateOptionId(),
                    text: option.text || (typeof option === 'string' ? option : ''),
                    votes: typeof option.votes === 'number' ? option.votes : 0
                }));
                poll = {
                    id: pollId,
                    question: data.question,
                    description: data.description || '',
                    options: options,
                    isMultipleChoice: data.isMultipleChoice || false,
                    createdAt: data.createdAt || new Date().toISOString(),
                    votedUsers: Array.isArray(data.votedUsers) ? data.votedUsers : [],
                    password: data.password || ''
                };
                pollManager.polls[pollId] = poll;
                pollManager.savePolls();
                pollManager.currentPoll = poll;
                document.getElementById('currentPollCode').textContent = pollId;
                document.querySelector('.main').style.display = 'none';
                document.querySelector('.header').style.display = 'none';
                document.getElementById('pollPage').style.display = 'block';
                renderPollContent();
            } else {
                showToast('Poll not found', 'error');
            }
        }, () => {
            showToast('Error loading poll', 'error');
        });
        return;
    }
    pollManager.currentPoll = poll;
    document.getElementById('currentPollCode').textContent = pollId;
    document.querySelector('.main').style.display = 'none';
    document.querySelector('.header').style.display = 'none';
    document.getElementById('pollPage').style.display = 'block';
    renderPollContent();
}

function goHome() {
    document.getElementById('pollPage').style.display = 'none';
    document.querySelector('.main').style.display = 'block';
    document.querySelector('.header').style.display = 'block';
    pollManager.currentPoll = null;
    renderPolls();
}

function renderPollContent() {
    const poll = pollManager.currentPoll;
    const hasVoted = pollManager.hasUserVoted(poll.id, pollManager.userId);
    const totalVotes = poll.options.reduce((sum, option) => sum + option.votes, 0);
    
    const selectedOptions = new Set();
    
    const content = `
        <div class="poll-info">
            <h1 class="poll-title">${poll.question}</h1>
            ${poll.description ? `<p class="poll-description">${poll.description}</p>` : ''}
            <div class="poll-meta">
                <span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    ${totalVotes} votes
                </span>
                <span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
                    </svg>
                    ${poll.options.length} options
                </span>
                ${poll.isMultipleChoice ? '<span class="poll-badge">Multiple Choice</span>' : ''}
                ${hasVoted ? '<span class="poll-badge">âœ“ Voted</span>' : ''}
            </div>
        </div>
        
        <div class="poll-options">
            ${poll.options.map(option => {
                const percentage = totalVotes > 0 ? (option.votes / totalVotes) * 100 : 0;
                return `
                    <div class="poll-option ${hasVoted ? 'disabled' : ''}" 
                         onclick="${hasVoted ? '' : `toggleOption('${option.id}')`}">
                        <div class="option-header">
                            <span class="option-text">${option.text}</span>
                            <div class="option-stats">
                                ${hasVoted ? `<span>${option.votes} votes</span>` : ''}
                                ${hasVoted ? `<span>${percentage.toFixed(1)}%</span>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
        
        ${!hasVoted ? `
            <div class="vote-section">
                <button class="vote-btn" onclick="submitVote()" disabled>
                    Submit Vote<span id="voteCount"></span>
                </button>
                ${poll.isMultipleChoice ? '<p class="vote-hint">You can select multiple options</p>' : ''}
            </div>
        ` : ''}
        
        ${hasVoted && totalVotes > 0 ? `
            <div class="results-summary">
                <h3>Results Summary</h3>
                <p>Total votes: <strong>${totalVotes}</strong></p>
                <p>Most popular: <strong>${poll.options.reduce((max, option) => option.votes > max.votes ? option : max).text}</strong></p>
            </div>
        ` : ''}
    `;
    
    document.getElementById('pollContent').innerHTML = content;
}

// Voting functionality
let selectedOptions = new Set();

function toggleOption(optionId) {
    const poll = pollManager.currentPoll;
    if (!poll || pollManager.hasUserVoted(poll.id, pollManager.userId)) return;
    
    if (poll.isMultipleChoice) {
        if (selectedOptions.has(optionId)) {
            selectedOptions.delete(optionId);
        } else {
            selectedOptions.add(optionId);
        }
    } else {
        selectedOptions.clear();
        selectedOptions.add(optionId);
    }
    
    // Update UI
    document.querySelectorAll('.poll-option').forEach(option => {
        const id = option.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
        if (id) {
            option.classList.toggle('selected', selectedOptions.has(id));
        }
    });
    
    // Update vote button
    const voteBtn = document.querySelector('.vote-btn');
    const voteCount = document.getElementById('voteCount');
    if (voteBtn) {
        voteBtn.disabled = selectedOptions.size === 0;
        if (voteCount) {
            voteCount.textContent = selectedOptions.size > 1 ? 's' : '';
        }
    }
}

function submitVote() {
    const poll = pollManager.currentPoll;
    if (!poll || selectedOptions.size === 0) return;
    
    const success = pollManager.vote(poll.id, Array.from(selectedOptions), pollManager.userId);
    if (success) {
        showToast('Vote submitted successfully!');
        selectedOptions.clear();
        renderPollContent();
        showVoteSuccessModal();
    } else {
        showToast('Unable to submit vote', 'error');
    }
}

// Load poll
db.collection('polls').doc(pollId).get().then(doc => {
  if (doc.exists) {
    // Show poll
  }
});

// Utility functions
function joinPoll() {
    const code = document.getElementById('joinCode').value.trim().toUpperCase();
    if (code) {
        showPoll(code);
    }
}

function copyPollCode() {
    const code = document.getElementById('currentPollCode').textContent;
    navigator.clipboard.writeText(code).then(() => {
        showToast('Poll code copied!');
    }).catch(() => {
        showToast('Failed to copy code', 'error');
    });
}

function sharePoll() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
        showToast('Poll link copied to clipboard!');
    }).catch(() => {
        showToast('Failed to copy link', 'error');
    });
}

function hashPassword(password) {
    // Simple hash for demo (not secure for real use)
    let hash = 0, i, chr;
    for (i = 0; i < password.length; i++) {
        chr   = password.charCodeAt(i);
        hash  = ((hash << 5) - hash) + chr;
        hash |= 0;
    }
    return hash.toString();
}

// Initialize app
document.addEventListener('DOMContentLoaded', function() {
    loadPollsFromFirestore();
    renderPolls();
    
    // Handle Enter key in join input
    document.getElementById('joinCode').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            joinPoll();
        }
    });
    
    // Close modal when clicking outside
    document.getElementById('pollCreatorModal').addEventListener('click', function(e) {
        if (e.target === this) {
            hideCreatePoll();
        }
    });

    // Show/Hide password toggle
    const passwordInput = document.getElementById('pollPassword');
    const toggleBtn = document.getElementById('togglePassword');
    if (passwordInput && toggleBtn) {
        toggleBtn.addEventListener('click', function() {
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.textContent = 'Hide';
            } else {
                passwordInput.type = 'password';
                toggleBtn.textContent = 'Show';
            }
        });
    }
});

function loadPollsFromFirestore() {
    db.collection('polls')
      .where('userId', '==', pollManager.userId)
      .get()
      .then(snapshot => {
          snapshot.forEach(doc => {
              const poll = doc.data();
              pollManager.polls[poll.id] = poll;
          });
          pollManager.savePolls();
          renderPolls();
      })
      .catch(error => {
          showToast('Failed to load polls from Firestore', 'error');
          console.error(error);
      });
}

function promptDeletePoll() {
    const poll = pollManager.currentPoll;
    if (!poll) return;
    const input = prompt('Enter the poll password to delete this poll:');
    if (input && hashPassword(input) === poll.password) {
        pollManager.deletePoll(poll.id);
        db.collection('polls').doc(poll.id).delete(); // <-- Add this
        showToast('Poll deleted!');
        goHome();
    } else if (input !== null) {
        showToast('Incorrect password', 'error');
    }
}

function showVoteSuccessModal() {
    document.getElementById('voteSuccessModal').style.display = 'flex';
}
function closeVoteSuccessModal() {
    document.getElementById('voteSuccessModal').style.display = 'none';
}

let summaryUnlocked = false;
</script>
</html>
